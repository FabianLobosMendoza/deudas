{% extends "finanzas/base.html" %}

{% block title %}Gastos{% endblock %}

{% block content %}
<h2>Gastos</h2>
<div class="top-actions">
    <a class="btn" href="{% url 'finanzas:nuevo_gasto' %}">Cargar gasto</a>
    <a class="btn" href="{% url 'finanzas:dashboard' %}">Volver al resumen</a>
</div>

<div style="margin:0.5rem 0 1rem;">
    <form method="get" id="filtro-gastos" style="display:flex;align-items:center;gap:0.5rem;">
        <label for="ver_todos" style="font-weight:600;">Ver todos</label>
        <label class="switch">
            <input type="checkbox" id="ver_todos" name="ver_todos" value="1" {% if ver_todos %}checked{% endif %} onchange="document.getElementById('filtro-gastos').submit();">
            <span class="slider"></span>
        </label>
        <span style="font-size:0.9rem;color:#4b5563;">(Por defecto se muestran solo no pagados)</span>
    </form>
</div>

<form method="post">
    {% csrf_token %}
    <table>
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Tipo</th>
                <th>Categoría</th>
                <th>Descripción</th>
                <th>Monto</th>
                <th>Estado</th>
                <th>Pagado</th>
            </tr>
        </thead>
        <tbody>
        {% for gasto in gastos %}
            <tr>
                <td>{{ gasto.fecha }}</td>
                <td>{{ gasto.get_tipo_display }}</td>
                <td>{{ gasto.categoria }}</td>
                <td>{{ gasto.descripcion }}</td>
                <td>${{ gasto.monto|floatformat:2 }}</td>
                <td>
                    {% if gasto.pagado %}
                        <span class="badge badge-pagado">Pagado</span>
                    {% else %}
                        {% if gasto.estado_vencimiento == 'vencido' %}
                            <span class="badge badge-alta">Vencido</span>
                        {% elif gasto.estado_vencimiento == 'hoy' %}
                            <span class="badge badge-media">Vence hoy</span>
                        {% elif gasto.estado_vencimiento == 'por_vencer' %}
                            <span class="badge badge-media">En {{ gasto.dias_para_vencer }} días</span>
                        {% else %}
                            <span class="badge">Sin fecha</span>
                        {% endif %}
                    {% endif %}
                </td>
                <td>
                    <input type="checkbox" name="pagado" value="{{ gasto.id }}" {% if gasto.pagado %}checked{% endif %}>
                </td>
            </tr>
        {% empty %}
            <tr><td colspan="7">No hay gastos cargados.</td></tr>
        {% endfor %}
        </tbody>
    </table>
    <button type="submit" class="btn" style="margin-top:1rem;">Guardar cambios</button>
</form>

<style>
.switch {
  position: relative;
  display: inline-block;
  width: 46px;
  height: 24px;
}
.switch input {display:none;}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #d1d5db;
  transition: .2s;
  border-radius: 999px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 18px; width: 18px;
  left: 3px; bottom: 3px;
  background-color: white;
  transition: .2s;
  border-radius: 50%;
  box-shadow: 0 1px 2px rgba(0,0,0,0.15);
}
input:checked + .slider {
  background-color: #1f2937;
}
input:checked + .slider:before {
  transform: translateX(22px);
}
</style>
{% endblock %}
